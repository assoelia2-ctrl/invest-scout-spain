import streamlit as st
import google.generativeai as genai
from PIL import Image

# 1. KONFIGURATION
st.set_page_config(page_title="Invest-Scout Spain 2026", layout="wide")
st.title("üè† Invest-Scout Spain: KI-Immobilien-Analyst")

# API-Key Eingabe (Sicherheit geht vor)
api_key = st.sidebar.text_input("Gemini API Key eingeben", type="password")

if api_key:
    genai.configure(api_key=api_key)
    
    # 2. DAS GEHIRN (Dein Master-Block)
    system_instruction = """
    # ROLE: Ultra-Autonomous Real Estate Investment Intelligence (Spain 2026)
    (Hier ist dein kompletter Master-Block integriert...)
    # MISSION-LOGIC: Analyse Bilder, berechne Renditen, nutze Advocatus Diaboli.
    # OUTPUT: Erstelle immer ein professionelles EXPOS√â.
    """
    
    model = genai.GenerativeModel(
        model_name="gemini-1.5-pro",
        system_instruction=system_instruction
    )

    # 3. INTERFACE
    col1, col2 = st.columns([1, 1])

    with col1:
        st.header("Input & Analyse")
        uploaded_file = st.file_uploader("Bild der Immobilie hochladen...", type=["jpg", "jpeg", "png"])
        if uploaded_file:
            image = Image.open(uploaded_file)
            st.image(image, caption="Hochgeladenes Objekt", use_container_width=True)
        
        user_query = st.text_area("Zus√§tzliche Infos oder Fragen:", 
                                 placeholder="Z.B. Budget 350k, Fokus auf Ferienvermietung in Malaga...")
        
        analyze_button = st.button("üöÄ Tiefen-Analyse starten")

    with col2:
        st.header("Ergebnis: Strategisches Expos√©")
        if analyze_button:
            with st.spinner("KI recherchiert, rechnet und pr√ºft Lizenzen..."):
                try:
                    # Kombiniere Bild und Text f√ºr die KI
                    content = []
                    if uploaded_file:
                        content.append(image)
                    content.append(user_query if user_query else "Analysiere dieses Objekt gem√§√ü deiner Instruktionen.")
                    
                    response = model.generate_content(content)
                    st.markdown(response.text)
                except Exception as e:
                    st.error(f"Fehler: {e}")

else:
    st.info("Bitte gib deinen Gemini API Key in der Seitenleiste ein, um die App zu starten.")

# 4. FOOTER
st.sidebar.markdown("---")
st.sidebar.write("Built for Strategic Investors | 2026 Edition")
